<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Módulo de Robótica y Automatización: Desafío Semáforo Inteligente</title>
<style>
  /* Paleta de colores moderna (Electric Blue - Profesional) */
  :root{
    --bg: #F5F7FA;             /* Fondo muy suave y claro */
    --card: #ffffff;           /* Fondo de tarjetas blanco puro */
    --primary: #448AFF;        /* Azul Eléctrico Vibrante */
    --primary-dark: #2979FF;   /* Azul más oscuro para hover y acción */
    --secondary: #78909C;      /* Gris azulado para texto secundario */
    --text-color: #263238;     /* Texto principal (Casi negro) */
    --border-color: #E0E0E0;   /* Bordes sutiles y claros */
    --shadow: 0 12px 40px rgba(0, 0, 0, 0.07); /* Sombra suave y amplia */
    --success: #00C853;        /* Verde de alto contraste */
    --warning: #FFAB00;        /* Amarillo/Naranja de alto contraste */
    --danger: #FF3D00;         /* Rojo puro y llamativo */
    --sim-bg: #212121;         /* Fondo oscuro para el simulador */
    --font-size-base: 1rem;
  }
  body{
    font-family: 'Inter', 'Segoe UI', Roboto, Arial, sans-serif;
    background: var(--bg);
    color: var(--text-color);
    margin: 0; padding: 30px;
    line-height: 1.6;
    font-size: var(--font-size-base);
    transition: background 0.3s;
  }
  .wrap{max-width: 1300px; margin: 0 auto;}
  header{
    padding: 25px 0; 
    text-align: center;
    background: var(--card);
    border-radius: 14px;
    margin-bottom: 30px;
    box-shadow: var(--shadow);
    border-bottom: 6px solid var(--primary); 
    /* Removido position: relative; */
    display: flex; 
    flex-direction: column;
    align-items: center;
  }
  .header-content { text-align: center; }
  /* TÍTULO ACTUALIZADO */
  h1{margin:0; color: var(--primary); font-size: 34px; font-weight: 800; letter-spacing: -0.5px;}
  .subtitle{color: var(--secondary); margin-top: 5px; font-size: 19px; font-weight: 400;}

  /* Botón de Explicación: Ahora usa flujo normal y margen superior */
  #infoButton {
    /* Removido posicionamiento absoluto */
    margin-top: 15px; /* Margen para separarlo del subtítulo */
    
    background: var(--primary); 
    color: white;
    border: none;
    padding: 12px 18px;
    border-radius: 8px; 
    cursor: pointer;
    font-weight: 600;
    transition: all 0.2s;
    font-size: 15px;
    box-shadow: 0 4px 12px rgba(68, 138, 255, 0.3);
  }
  #infoButton:hover { 
    background: var(--primary-dark); 
    transform: scale(1.03); /* Efecto de crecimiento sutil al pasar el mouse */
  }

  .container{
    display: grid;
    grid-template-columns: 1fr 1.2fr 1fr; 
    gap: 30px;
  }
  .card{
    background: var(--card);
    padding: 30px;
    border-radius: 14px;
    box-shadow: var(--shadow); 
    height: fit-content;
    border: 1px solid var(--border-color);
    transition: transform 0.3s, box-shadow 0.3s;
  }
  .card:hover { transform: translateY(-5px); box-shadow: 0 15px 45px rgba(0, 0, 0, 0.1); } 

  h2{
    margin: 0 0 20px;
    color: var(--text-color);
    font-size: 22px;
    font-weight: 700;
    position: relative;
    padding-bottom: 15px;
  }
  h2::after {
      content: '';
      position: absolute;
      left: 0;
      bottom: 0;
      width: 60px;
      height: 4px; 
      background: var(--primary);
      border-radius: 2px;
  }
  .info-text{font-size: 16px; color: var(--secondary); margin-bottom: 20px;}
  
  /* Secciones de Detalle (Acordeones) */
  details{
    margin: 20px 0;
    background: #eef3f7; 
    padding: 20px;
    border-radius: 12px;
    border: 1px solid var(--border-color);
    transition: all 0.2s;
  }
  details:hover { background: #e3e9f0; }
  details summary{
    cursor: pointer;
    font-weight: 700;
    color: var(--text-color);
    font-size: 17px;
    list-style: none; 
    padding-left: 0;
  }
  details summary::before {
      content: '► '; 
      display: inline-block;
      margin-right: 10px;
      transition: transform 0.2s;
      color: var(--primary);
      font-size: 0.9em;
  }
  details[open] summary::before {
      content: '▼ ';
  }
  details p, details ul{margin: 10px 0; font-size: 15px; padding-left: 0;}
  details ul {padding-left: 25px; list-style: none;}
  details li {margin-bottom: 10px; position: relative; padding-left: 18px; }
  details li::before {
      content: '—'; 
      position: absolute;
      left: 0;
      color: var(--primary);
      font-weight: 800;
  }

  /* Simulador */
  .semaforo-sim{
    width: 160px; 
    margin: 30px auto 40px auto; 
    background: var(--sim-bg);
    padding: 25px;
    border-radius: 30px;
    display: flex; flex-direction: column; gap: 20px; align-items: center;
    box-shadow: 0 8px 20px rgba(0,0,0,0.7); 
  }
  .light{
    width: 70px; height: 70px;
    border-radius: 50%;
    background: #555;
    transition: background 0.2s, box-shadow 0.2s;
    box-shadow: inset 0 -4px 10px rgba(0,0,0,0.5);
  }
  .light.red.on{background: var(--danger); box-shadow: 0 0 35px var(--danger);}
  .light.yellow.on{background: var(--warning); box-shadow: 0 0 35px var(--warning);}
  .light.green.on{background: var(--success); box-shadow: 0 0 35px var(--success);}

  /* Controles (Botones) - Espacio mejorado */
  .controls{
    display:flex; 
    gap: 15px; 
    flex-wrap: wrap; 
    justify-content: center; 
    margin-top: -10px; 
    margin-bottom: 25px;
  }
  .btn{
    background: var(--primary);
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px; 
    transition: all 0.2s;
    font-weight: 600;
    flex-grow: 1;
    min-width: 140px;
    box-shadow: 0 4px 12px rgba(68, 138, 255, 0.3);
    text-transform: uppercase;
  }
  .btn:active {transform: translateY(2px); box-shadow: 0 1px 5px rgba(0, 0, 0, 0.2);}
  .btn:hover{background: var(--primary-dark);}
  .btn.secondary{background: var(--secondary); box-shadow: 0 4px 12px rgba(120, 144, 156, 0.3);}
  .btn.secondary:hover{background: #546E7A;}

  .range-label{font-size: 15px; display: block; margin-top: 20px; color: var(--text-color); font-weight: 500;}
  .range{width: 100%; margin-top: 10px;}
  .progress{width: 100%; height: 12px; background: var(--border-color); border-radius: 6px; overflow: hidden; margin-top: 10px;}
  .progress-bar{height: 100%; width: 0%; background: var(--success); transition: width 0.1s linear;}

  /* Rúbrica */
  .rubrica-container{background: #f0f4f7; padding: 30px; border-radius: 12px; border: 1px solid var(--border-color);}
  .rubrica select{padding: 12px; border-radius: 8px; border: 1px solid #B0BEC5; margin-top: 10px; width: 100%; font-size: 15px; background: white;}
  .rubrica label{display:block; font-weight: 700; margin-bottom: 5px; color: var(--text-color);}
  .rubrica small{display: block; margin-bottom: 18px; font-size: 14px; color: var(--secondary);}
  .rubrica .total-score {font-size: 1.6rem; font-weight: 800; color: var(--primary);}
  
  /* ESTILOS DEL MODAL DE EXPLICACIÓN */
  .modal-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0, 0, 0, 0.75);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }
  .modal-content {
    background: var(--card);
    padding: 40px;
    border-radius: 16px;
    width: 90%;
    max-width: 650px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
    position: relative;
    animation: fadeIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
  }
  .modal-content h3 {
    color: var(--primary);
    font-size: 26px;
    border-bottom: 3px solid var(--border-color);
    padding-bottom: 10px;
    margin-top: 0;
    margin-bottom: 25px;
    font-weight: 800;
  }
  .modal-content h4 {
    color: var(--text-color);
    font-size: 19px;
    margin-top: 25px;
    margin-bottom: 10px;
    font-weight: 700;
    border-left: 4px solid var(--primary);
    padding-left: 10px;
  }
  .close-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    background: none;
    border: none;
    font-size: 30px;
    cursor: pointer;
    color: var(--secondary);
    line-height: 1;
    transition: color 0.2s;
  }
  .close-btn:hover { color: var(--danger); }
  @keyframes fadeIn {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
  }
  
  @media (max-width: 1000px){ .container{grid-template-columns: 1fr;} }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="header-content">
        <h1>Módulo de Robótica y Automatización: Desafío Semáforo Inteligente</h1>
        <p class="subtitle">Aplicando la Robótica para el Control y la Inteligencia Vial</p>
      </div>
      <button id="infoButton" onclick="openModal()">Explicación del Módulo</button>
    </header>

    <div class="container">
      <div class="card">
        <h2>Fase 1: Esquematización y Diseño</h2>
        <p class="info-text">Documenta las decisiones de diseño que tomaste antes de programar o montar el circuito. Esta fase es crítica para la planificación.</p>
        
        <details open>
          <summary>Componentes y Conexión Electrónica</summary>
          <p>
            Materiales necesarios: **Micro:bit**, protoboard, 3 LEDs, 3 resistencias, 1 pulsador.
          </p>
          <p>
            Desafío de Pines: Asigna y justifica el uso de cada Pin digital (P0, P1, P2, etc.) de la Micro:bit para cada función.
          </p>
          <ul>
            <li>Pin de Salida (Luz de paso, Verde): ______</li>
            <li>Pin de Salida (Luz de precaución, Amarillo): ______</li>
            <li>Pin de Salida (Luz de detención, Rojo): ______</li>
            <li>Pin de Entrada (Botón Peatonal): ______</li>
          </ul>
        </details>
        
        <details>
          <summary>Diseño de la Estructura Física (Maqueta)</summary>
          <p>
            Describe el diseño de tu poste y carcasa del semáforo. ¿Cómo se sostendrá? ¿Qué materiales usarás para asegurar la visibilidad de las luces?
          </p>
        </details>
      </div>

      <div class="card">
        <h2>Fase 2: Prototipado y Validación</h2>
        <p class="info-text">Utiliza este simulador para validar si tu lógica de tiempo y secuencia es correcta. Este es tu banco de pruebas antes de la construcción final.</p>
        <div class="semaforo-sim" id="simulator">
          <div class="light red" id="redLight" title="Rojo"></div>
          <div class="light yellow" id="yellowLight" title="Amarillo"></div>
          <div class="light green" id="greenLight" title="Verde"></div>
        </div>
        <div class="controls">
          <button class="btn" onclick="startSimulation()">Iniciar Prueba</button>
          <button class="btn" id="pedestrianBtn" onclick="requestPedestrian()">Activar Peatón</button>
          <button class="btn secondary" onclick="stopSimulation()">Detener Prueba</button>
        </div>
        <label class="range-label">Velocidad del Ciclo (Control de tiempo):
          <input type="range" min="500" max="3000" value="1500" step="100" id="speedRange" class="range">
        </label>
        <div class="progress"><div class="progress-bar" id="progressBar"></div></div>
        
        <details open>
          <summary>Desafío de Programación (Sin soluciones)</summary>
          <p>
            <strong>Tarea Principal:</strong> Crea el código en MakeCode para que la secuencia de luces se ejecute de forma indefinida y segura, respetando los tiempos viales.
          </p>
          <p>
            <strong>Desafío Inteligente:</strong> Modifica tu código para que la luz **Verde** se acorte y el **Rojo** se extienda solo cuando el botón peatonal sea presionado. Esto requiere el uso de **estructuras condicionales** y variables de estado.
          </p>
          <p style="margin-top:15px;">
            <a href="https://makecode.microbit.org/#editor" target="_blank" style="color: var(--primary); text-decoration: none; font-weight: 600;">Abrir Editor MakeCode para empezar tu código</a>
          </p>
        </details>
      </div>

      <div class="card">
        <h2>Fase 3: Investigación y Análisis</h2>
        <p class="info-text">Esta fase requiere documentar tu investigación, registrar los resultados de tus pruebas de prototipo y emitir conclusiones finales.</p>

        <details>
            <summary>3.1 Investigación Vial y Estándares</summary>
            <p>
                Documenta tus hallazgos sobre las normas viales o tiempos de semáforo recomendados en tu región para asegurar que tu diseño sea realista.
            </p>
            <ul>
                <li>Tiempo promedio de luz Verde (Vehículos): ______ segundos</li>
                <li>Tiempo promedio de luz Roja (Detención): ______ segundos</li>
                <li>Tiempo de cruce peatonal requerido: ______ segundos</li>
            </ul>
        </details>

        <details>
            <summary>3.2 Resultados y Pruebas del Prototipo</summary>
            <p>
                Registra la validación de tu código y circuito. Utiliza el simulador o el hardware físico para llenar las siguientes pruebas:
            </p>
            <ul>
                <li>**Prueba 1: Secuencia Básica.** ¿La luz Roja sucede al Amarillo y el Verde al Rojo? (Sí/No)</li>
                <li>**Prueba 2: Interrupción Peatonal.** ¿Al pulsar el botón en Verde, se acorta el ciclo y se extiende el Rojo? (Sí/No)</li>
                <li>**Prueba 3: Tiempos Seguros.** Tiempo total del ciclo (normal): ______ segundos.</li>
            </ul>
            <textarea style="width:100%; height:80px; margin-top:10px; border-radius:6px; border:1px solid var(--border-color); padding:8px; font-size:14px;" placeholder="Observaciones de las pruebas..."></textarea>
        </details>
        
        <details open>
            <summary>3.3 Conclusiones de Ingeniería</summary>
            <p>
                **Eficiencia del Código:** ¿Qué estructuras de control (bucles, condicionales) fueron claves? Justifica por qué tu código es limpio y funcional.
            </p>
            <p>
                **Impacto en Seguridad Vial:** ¿Cómo tu solución de automatización mejora la seguridad de peatones y vehículos en comparación con un semáforo de tiempo fijo?
            </p>
            <textarea style="width:100%; height:100px; margin-top:10px; border-radius:6px; border:1px solid var(--border-color); padding:8px; font-size:14px;" placeholder="Conclusión final del proyecto..."></textarea>
        </details>
        
        <h2 style="margin-top:25px; margin-bottom:15px; color: var(--text-color);">Rúbrica de Evaluación</h2>
        <div class="rubrica-container">
          <div class="criterio" style="margin-bottom:15px;">
            <label for="r1">1. Secuencia de Luces y Tiempos</label>
            <small>El sistema respeta la secuencia y los tiempos de detención/paso son lógicos y seguros.</small>
            <select id="r1">
              <option value="4">4 - Logrado</option><option value="2">2 - Parcialmente Logrado</option><option value="1">1 - No Logrado</option>
            </select>
          </div>
          <div class="criterio" style="margin-bottom:15px;">
            <label for="r2">2. Funcionamiento de Botón Peatonal</label>
            <small>La lógica del código gestiona correctamente la prioridad peatonal y la seguridad vehicular.</small>
            <select id="r2">
              <option value="4">4 - Logrado</option><option value="2">2 - Parcialmente Logrado</option><option value="1">1 - No Logrado</option>
            </select>
          </div>
          <div class="criterio" style="margin-bottom:15px;">
            <label for="r3">3. Eficiencia del Código</label>
            <small>El programa es limpio y usa estructuras de control (bucles y condicionales) de forma correcta.</small>
            <select id="r3">
              <option value="4">4 - Logrado</option><option value="2">2 - Parcialmente Logrado</option><option value="1">1 - No Logrado</option>
            </select>
          </div>
          <div class="criterio" style="margin-bottom:20px;">
            <label for="r4">4. Documentación y Análisis</label>
            <small>La esquematización y la reflexión final son claras, detalladas y justificadas.</small>
            <select id="r4">
              <option value="4">4 - Logrado</option><option value="2">2 - Parcialmente Logrado</option><option value="1">1 - No Logrado</option>
            </select>
          </div>
          <div style="margin-top:10px; display:flex; align-items:center; justify-content:space-between;">
            <button class="btn" onclick="calcRubric()" style="padding:10px 14px; font-size:15px; min-width: 120px;">Calcular Puntaje Total</button>
            <span class="total-score">Total: <span id="rubricTotal">0</span> / 16</span>
          </div>
        </div>
      </div>
    </div>
    <footer>
      <p style="margin-top:40px; color:var(--secondary); text-align:center; font-size:14px;">© 2025 Proyecto Educativo STEM | Herramienta Didáctica de Diseño</p>
    </footer>
  </div>
  
  <div id="infoModal" class="modal-overlay">
      <div class="modal-content">
          <button class="close-btn" onclick="closeModal()">×</button>
          <h3>Robótica y Automatización en Sistemas Viales</h3>
          <p>Este desafío te introduce a la **Robótica y Automatización aplicadas a Sistemas Viales**, una disciplina clave de la ingeniería moderna. El objetivo es que comprendas cómo un dispositivo puede tomar decisiones en tiempo real para gestionar el flujo de tráfico y mejorar la seguridad ciudadana.</p>
          
          <h4>El Semáforo como Sistema de Automatización</h4>
          <p>En esencia, un semáforo inteligente es un **Sistema Ciber-Físico**. La placa **Micro:bit** actúa como el **microcontrolador** o **"cerebro"** de tu sistema, aplicando la **lógica de la Robótica** al control de tráfico, tomando decisiones lógicas basadas en tres componentes clave:</p>
          
          <ul>
              <li>**Entrada (Sensores/Inputs):** Capturan la información del entorno. En este caso, el **tiempo** (para la secuencia vial automática) y el **botón pulsador** (como sensor de solicitud peatonal).</li>
              <li>**Proceso (Lógica/Código):** Es el corazón del sistema robótico. Aquí se utilizan las **estructuras condicionales** (`IF...THEN...ELSE`) para decidir cuándo modificar la secuencia estándar (e.g., *SI* el botón fue presionado *Y* la luz es Verde, *ENTONCES* acortar el Verde y extender el Rojo).</li>
              <li>**Salida (Actuadores):** Ejecutan las órdenes. En este proyecto, son los **LEDs** (las luces del semáforo) que se encienden o apagan según la decisión del código.</li>
          </ul>

          <h4>Objetivo y Desafío Principal</h4>
          <p>Tu reto no es solo encender luces en secuencia, sino programar un sistema que demuestre **inteligencia adaptativa**, priorizando la seguridad del peatón sin comprometer la fluidez vehicular.</p>
          
          <ul style="list-style-type: disc;">
              <li>**Resultado esperado:** Un sistema que garantice que la luz Roja se extienda lo necesario para que el peatón cruce *solo* si el botón fue presionado durante el ciclo de paso vehicular (Verde).</li>
          </ul>
      </div>
  </div>

<script>
// --- CÓDIGO DE SIMULACIÓN (Herramienta de Prueba sin Solución) ---
let running = false;
let step = 0; 
let timer;
let progressTimer;
let pedestrianRequest = false;

// FACTORES DE TIEMPO 
const YELLOW_FACTOR = 0.5; 
const PEDESTRIAN_FACTOR = 1.5; 

const lights = {
    red: document.getElementById('redLight'),
    yellow: document.getElementById('yellowLight'),
    green: document.getElementById('greenLight')
};
const progress = document.getElementById('progressBar');
const speedRange = document.getElementById('speedRange');
const infoModal = document.getElementById('infoModal');

// Funciones para el Modal
function openModal() {
    infoModal.style.display = 'flex';
}

function closeModal() {
    infoModal.style.display = 'none';
}

// Cierra el modal al hacer clic fuera
infoModal.addEventListener('click', (e) => {
    if (e.target === infoModal) {
        closeModal();
    }
});


function resetLights() {
    for (const k in lights) {
        lights[k].classList.remove('on');
    }
} 

function startSimulation() {
    if (running) return;
    running = true;
    pedestrianRequest = false;
    step = 2; 
    cycle();
}

function stopSimulation() {
    running = false;
    resetLights();
    clearTimeout(timer);
    clearInterval(progressTimer);
    progress.style.width = '0%';
    step = 0;
}

// LÓGICA DEL CICLO DE SEMÁFORO (Simula la lógica que el estudiante debe programar)
function cycle() {
    if (!running) return;
    resetLights();

    const speedValue = parseInt(speedRange.value);
    let duration = speedValue; 
    
    switch (step) {
        case 0: // VERDE (Paso)
            lights.green.classList.add('on');
            
            // Lógica de desafío: el verde se acorta si hay solicitud peatonal
            if (pedestrianRequest) {
                duration = speedValue * 0.75; 
                console.log("Ciclo de luz verde acortado por solicitud peatonal.");
            }
            step = 1;
            break;

        case 1: // AMARILLO (Precaución)
            lights.yellow.classList.add('on');
            duration = speedValue * YELLOW_FACTOR; 
            step = 2;
            break;

        case 2: // ROJO (Detención)
            lights.red.classList.add('on');
            duration = speedValue;
            
            // Lógica de desafío: Se alarga el rojo si se atiende la solicitud
            if (pedestrianRequest) {
                duration = speedValue * PEDESTRIAN_FACTOR;
                console.log("Luz roja extendida para permitir cruce peatonal.");
                pedestrianRequest = false; 
            }
            step = 0;
            break;
    }

    animateProgress(duration);
    timer = setTimeout(cycle, duration);
}

// LÓGICA DEL BOTÓN PEATONAL
function requestPedestrian() {
    if (!running) return alert('Por favor, inicia la simulación para probar esta funcionalidad.');
    if (step === 2) return alert('La luz principal ya está en rojo. El cruce es seguro.');
    
    if (step === 0) { 
        pedestrianRequest = true;
        alert('Solicitud de Peatón recibida. El semáforo dará paso al cruce tan pronto como sea seguro.');
    }
}

// FUNCIÓN DE ANIMACIÓN
function animateProgress(d) {
    let start = Date.now();
    clearInterval(progressTimer);
    progressTimer = setInterval(() => {
        let p = (Date.now() - start) / d;
        if (p >= 1) {
            p = 1;
            clearInterval(progressTimer);
        }
        progress.style.width = (p * 100) + '%';
    }, 50);
}

// FUNCIÓN DE RÚBRICA
function calcRubric() {
  const total = 
    parseInt(document.getElementById("r1").value) +
    parseInt(document.getElementById("r2").value) +
    parseInt(document.getElementById("r3").value) +
    parseInt(document.getElementById("r4").value);
  document.getElementById("rubricTotal").innerText = total;
}

// Event listeners para el control de velocidad
speedRange.addEventListener('input', () => {
    if(running) {
        stopSimulation();
        startSimulation();
    }
});
</script>
</body>
</html>